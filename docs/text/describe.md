# 模块介绍
`文本`部分核心功能时将文本输入，转化为音频，字幕等文件。

## 配置要求
1. 运行需要本地推理生成音频的服务（目前包括GPT-SoVITS、Fish-Speech、ChatTTS），

2. 需要本地电脑配置有一定要求并且已启动对应的服务，且服务配置的对应端口号及配置信息都和本地启动一致，否则在使用相关功能时会失败。

## 大模型接口配置
需要修改的配置有`模型`中的`文本大模型`、`音频大模型`，关于各模态大模型的启动部分，可参考各大模型的集成。

::: danger 注意
项目中所有模型使用的本地文件都使用缓存方式加载，如本地有新增或删除模型等，需先刷新缓存。
:::
## 参考音频配置
1. 点击`模型`中的`参考音频`，右侧`刷新缓存`按钮。
2. 点击`排序配置`，选择要展示的参考音频分组。


## 创建项目
文本项目当前有两个类型：章节长文本和短文本。章节长文本项目主要用于文本较长，需要分章节处理的文本。短文本项目没有分章节的部分，所有文本当作一个章节处理。

::: danger 请合理选择类型！
在页面展示及推理时，会把一个章节看作一个整体处理。

单章节文本过长会导致展示时页面卡顿甚至浏览器卡死、推理时上下文过长导致的失败等问题。
::: 

## 章节拆分（章节长文本项目）
1. 点击进入空间后，点击左上角`章节拆分`按钮，选择章节规则后点击`验证`会在右侧出现章节列表。
2. 下拉框中没有对应的正则时，可求助AI大模型，帮你生成章节名解析的正则表达式，然后填入输入框。
3. 台词解析规则是识别文本中的对话的重要配置。这里可以全局配置，也可以在对用章节处理时单独配置。

![](IMAGE_BASE_URL/files/aigc-platform-doc/8feeae95357a4cbdb88ed869013eca7d.png)

## 台词解析
1. 点击左侧二级菜单中章节列表进入对应的章节页面，点击`中间上方`的`台词解析`按钮。
2. 在下拉框中选择对应的解析规则。没有对应的正则时，可求助AI大模型，然后填入输入框。
3. 点击验证后会在右侧出现对话列表，这部分是后面需要角色推理的内容，其他当作`旁白`处理。
 
![](IMAGE_BASE_URL/files/aigc-platform-doc/566d6f943f6b43518a63a01da130fe67.png)

## 设置预置角色
预置角色是项目中的预先配置的角色及模型关系，会根据后面角色后的角色名匹配自动加载预置角色绑定模型配置。
1. 点击右侧角色操作栏中的`预置角色`，`添加预置角色`

![](IMAGE_BASE_URL/files/aigc-platform-doc/a521bdfedd954484a02105678ea99609.png)

## 角色推理
完成上一步的台词解析后，点击`角色推理`按钮，会调用文本大模型角色推理。这一步可关注控制台是否有实时结果输出、有错误时页面的错误提示。
::: danger 注意！
在角色推理时，需要有一个激活状态的文本大模型配置！
:::

当角色推理成功后，你的页面会是这样。

![](IMAGE_BASE_URL/files/aigc-platform-doc/c5f5d5bf7d344fc7810bb47e358fbb2b.png)

## 模型设置
1. 点击文中角色栏对应角色展开，点击`选择模型`。
2. 如果推理的角色有重复或者名字不符合要求。可以点击`角色改名`，`删除角色`处理。

## 音频生成
所有模型设置完毕后，点击中间上方`批量生成`或操作栏中对应的`🔄️`

::: danger 注意！
在音频生成时，需要启动对应的音频大模型！
:::

## 音频合并
所有音频生成完成后，点击表格首列选中要合并导出的语音，然后点击中间上方`合并导出`按钮。
生成后的音频位置在：`project\text\斗破苍穹测试\output`

## 字幕优化
设置 =》通用设置 =》字幕优化 

开启这个功能，会有文本切分的效果，会将文本切分为推荐长度的小文本以便准确计算字幕时间。

可以在合成音频后 音频播放 =》音频预览 页面查看。

::: danger 注意！
开启这个功能需要重新生成音频才生效
:::